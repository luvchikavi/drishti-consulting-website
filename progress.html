<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Progress - Drishti Consulting</title>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;500;600;700&family=Heebo:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #0ea5e9;
            --accent: #8b5cf6;
            --dark: #0f172a;
            --darker: #020617;
            --light: #f8fafc;
            --gray: #64748b;
            --gray-light: #94a3b8;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --gradient: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #d946ef 100%);
        }

        body {
            font-family: 'Open Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--darker);
            color: var(--light);
            min-height: 100vh;
            line-height: 1.6;
        }

        body.rtl {
            font-family: 'Heebo', -apple-system, BlinkMacSystemFont, sans-serif;
            direction: rtl;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .header { text-align: center; margin-bottom: 40px; }

        .lang-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 8px;
        }

        .lang-btn {
            padding: 8px 16px;
            border: 1px solid rgba(255,255,255,0.2);
            background: rgba(255,255,255,0.05);
            color: var(--gray-light);
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            font-family: inherit;
            transition: all 0.2s;
        }

        .lang-btn.active {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        .lang-btn:hover { background: rgba(255,255,255,0.1); }

        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 14px;
            margin-bottom: 8px;
        }

        .logo-icon { width: 52px; height: 52px; }

        .logo-text {
            font-size: 32px;
            font-weight: 700;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            color: var(--gray);
            font-size: 14px;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .project-name {
            font-size: 28px;
            font-weight: 700;
            margin-top: 30px;
            margin-bottom: 8px;
        }

        .client-name { color: var(--gray-light); font-size: 16px; }

        .progress-card {
            background: rgba(99, 102, 241, 0.1);
            border: 1px solid rgba(99, 102, 241, 0.2);
            border-radius: 16px;
            padding: 30px;
            margin: 30px 0;
            text-align: center;
        }

        .progress-label { font-size: 14px; color: var(--gray-light); margin-bottom: 12px; }

        .progress-bar-container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            height: 20px;
            overflow: hidden;
            margin-bottom: 12px;
        }

        .progress-bar {
            background: var(--gradient);
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .progress-value {
            font-size: 56px;
            font-weight: 800;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .dates { margin-top: 20px; font-size: 14px; color: var(--gray-light); }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 30px 0;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }

        .stat-value { font-size: 28px; font-weight: 700; color: var(--light); margin-bottom: 4px; }
        .stat-label { font-size: 12px; color: var(--gray); text-transform: uppercase; letter-spacing: 0.5px; }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin: 30px 0;
        }

        .chart-card {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            padding: 24px;
        }

        .chart-title { font-size: 14px; font-weight: 600; margin-bottom: 16px; color: var(--gray-light); }
        .chart-container { position: relative; height: 200px; }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            margin: 40px 0 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .timeline { position: relative; padding-left: 30px; }
        body.rtl .timeline { padding-left: 0; padding-right: 30px; }

        .timeline::before {
            content: '';
            position: absolute;
            left: 10px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: rgba(255, 255, 255, 0.1);
        }

        body.rtl .timeline::before { left: auto; right: 10px; }

        .stage {
            position: relative;
            margin-bottom: 20px;
            padding: 16px;
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 12px;
        }

        .stage.completed { border-color: rgba(16, 185, 129, 0.3); }
        .stage.in_progress { border-color: var(--primary); background: rgba(99, 102, 241, 0.05); }

        .stage-icon {
            position: absolute;
            left: -30px;
            top: 20px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            background: var(--darker);
            border: 2px solid var(--gray);
        }

        body.rtl .stage-icon { left: auto; right: -30px; }

        .stage.completed .stage-icon { background: var(--success); border-color: var(--success); color: white; }
        .stage.in_progress .stage-icon { background: var(--primary); border-color: var(--primary); color: white; }

        .stage-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px; }
        .stage-name { font-weight: 600; font-size: 15px; }
        .stage-progress { font-size: 14px; color: var(--gray-light); }
        .stage.completed .stage-progress { color: var(--success); }
        .stage.in_progress .stage-progress { color: var(--primary); }
        .stage-hours { font-size: 12px; color: var(--gray); margin-bottom: 8px; }

        .stage-notes {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            padding: 10px;
            font-size: 13px;
            margin-top: 10px;
        }

        .stage-notes strong {
            color: var(--gray-light);
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Enhanced Blockers Section */
        .blockers-section {
            background: rgba(239, 68, 68, 0.08);
            border: 1px solid rgba(239, 68, 68, 0.25);
            border-radius: 12px;
            padding: 20px;
            margin: 30px 0;
        }

        .blockers-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 16px;
        }

        .blockers-icon {
            width: 24px;
            height: 24px;
            background: var(--danger);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }

        .blockers-title {
            font-size: 16px;
            font-weight: 600;
            color: #fca5a5;
        }

        .blocker-item {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 14px;
            margin-bottom: 10px;
        }

        .blocker-item:last-child { margin-bottom: 0; }

        .blocker-text { color: #fca5a5; font-size: 14px; margin-bottom: 8px; }

        .blocker-action {
            background: rgba(239, 68, 68, 0.15);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 6px;
            padding: 10px;
            font-size: 13px;
        }

        .action-label {
            color: var(--warning);
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .action-text { color: var(--light); }

        /* Technical Details Section */
        .tech-section {
            background: rgba(99, 102, 241, 0.05);
            border: 1px solid rgba(99, 102, 241, 0.2);
            border-radius: 12px;
            padding: 20px;
            margin: 30px 0;
        }

        .tech-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 16px;
        }

        .tech-icon {
            width: 24px;
            height: 24px;
            background: var(--primary);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .tech-title { font-size: 16px; font-weight: 600; }

        .tech-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }

        .tech-card {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 14px;
        }

        .tech-card-title {
            font-size: 12px;
            color: var(--gray-light);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .tech-card-content { font-size: 14px; }

        .code-block {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 6px;
            padding: 12px;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 11px;
            overflow-x: auto;
            white-space: pre;
            color: #a5f3fc;
            margin-top: 8px;
        }

        .deliverables-list {
            list-style: none;
            padding: 0;
        }

        .deliverables-list li {
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
        }

        .deliverables-list li:last-child { border-bottom: none; }

        .deliverable-status {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
        }

        .deliverable-done { background: var(--success); color: white; }
        .deliverable-pending { background: var(--gray); color: white; }

        /* Client Feedback Section */
        .feedback-section {
            background: rgba(14, 165, 233, 0.08);
            border: 1px solid rgba(14, 165, 233, 0.25);
            border-radius: 12px;
            padding: 24px;
            margin: 30px 0;
        }

        .feedback-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .feedback-icon {
            width: 28px;
            height: 28px;
            background: var(--secondary);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }

        .feedback-title { font-size: 18px; font-weight: 600; }
        .feedback-subtitle { color: var(--gray-light); font-size: 14px; margin-bottom: 20px; }

        .feedback-form { display: flex; flex-direction: column; gap: 16px; }

        .form-group { display: flex; flex-direction: column; gap: 6px; }
        .form-label { font-size: 13px; color: var(--gray-light); font-weight: 500; }

        .form-textarea {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 14px;
            color: var(--light);
            font-family: inherit;
            font-size: 14px;
            resize: vertical;
            min-height: 100px;
        }

        .form-textarea:focus {
            outline: none;
            border-color: var(--secondary);
        }

        .form-textarea::placeholder { color: var(--gray); }

        .form-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--gradient);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(99, 102, 241, 0.3);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover { background: #059669; }

        .btn-outline {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: var(--light);
        }

        .btn-outline:hover { background: rgba(255, 255, 255, 0.05); }

        .current-stage-card {
            background: rgba(99, 102, 241, 0.1);
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin: 30px 0;
        }

        .current-stage-label {
            font-size: 12px;
            color: var(--primary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }

        .current-stage-name { font-size: 20px; font-weight: 600; margin-bottom: 12px; }

        .footer {
            text-align: center;
            margin-top: 50px;
            padding-top: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--gray);
            font-size: 14px;
        }

        .footer a { color: var(--primary); text-decoration: none; }

        .error-message { text-align: center; padding: 60px 20px; }
        .error-message h2 { color: var(--danger); margin-bottom: 16px; }

        /* Toast notification */
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--success);
            color: white;
            padding: 16px 24px;
            border-radius: 10px;
            font-weight: 600;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s;
            z-index: 2000;
        }

        .toast.show { transform: translateY(0); opacity: 1; }

        @media (max-width: 768px) {
            .container { padding: 20px 16px; }
            .header { margin-bottom: 24px; }
            .logo-container { gap: 10px; }
            .logo-icon { width: 40px; height: 40px; }
            .logo-text { font-size: 24px; }
            .subtitle { font-size: 11px; letter-spacing: 1px; }
            .project-name { font-size: 20px; margin-top: 20px; }
            .client-name { font-size: 14px; }
            .progress-card { padding: 20px; margin: 20px 0; }
            .progress-value { font-size: 36px; }
            .progress-label { font-size: 12px; }
            .dates { font-size: 12px; }
            .stats-grid { grid-template-columns: repeat(2, 1fr) !important; gap: 10px; margin: 20px 0; }
            .stat-card { padding: 14px; }
            .stat-value { font-size: 22px; }
            .stat-label { font-size: 10px; }
            .charts-grid { grid-template-columns: 1fr; gap: 16px; margin: 20px 0; }
            .chart-card { padding: 16px; }
            .chart-container { height: 180px; }
            .section-title { font-size: 16px; margin: 30px 0 16px; }
            .timeline { padding-left: 24px; }
            body.rtl .timeline { padding-left: 0; padding-right: 24px; }
            .stage { padding: 12px; margin-bottom: 12px; }
            .stage-icon { left: -24px; width: 16px; height: 16px; font-size: 10px; }
            body.rtl .stage-icon { left: auto; right: -24px; }
            .stage-name { font-size: 13px; }
            .stage-progress { font-size: 12px; }
            .stage-hours { font-size: 11px; }
            .stage-notes { padding: 8px; font-size: 12px; }
            .blockers-section { padding: 16px; margin: 20px 0; }
            .blockers-title { font-size: 14px; }
            .blocker-item { padding: 12px; }
            .blocker-text { font-size: 13px; }
            .blocker-action { padding: 8px; font-size: 12px; }
            .tech-section { padding: 16px; margin: 20px 0; }
            .tech-grid { grid-template-columns: 1fr; gap: 12px; }
            .tech-card { padding: 12px; }
            .code-block { font-size: 10px; padding: 10px; }
            .current-stage-card { padding: 16px; margin: 20px 0; }
            .current-stage-name { font-size: 16px; }
            .feedback-section { padding: 16px; margin: 20px 0; }
            .feedback-title { font-size: 16px; }
            .feedback-subtitle { font-size: 13px; }
            .form-textarea { min-height: 80px; font-size: 14px; }
            .form-actions { flex-direction: column; gap: 10px; }
            .btn { width: 100%; justify-content: center; padding: 14px 20px; }
            .lang-toggle { position: static; justify-content: center; margin-bottom: 16px; }
            .lang-btn { padding: 6px 12px; font-size: 12px; }
            .footer { margin-top: 30px; padding-top: 20px; }
            .footer-contact { font-size: 11px; }
        }

        @media (max-width: 480px) {
            .container { padding: 16px 12px; }
            .project-name { font-size: 18px; }
            .progress-value { font-size: 32px; }
            .stat-value { font-size: 20px; }
            .stage-header { flex-direction: column; align-items: flex-start; gap: 4px; }
            .chart-container { height: 200px; }
            .chart-title { font-size: 13px !important; }
            .charts-grid { gap: 12px; }
            .chart-card { padding: 14px; border-radius: 12px; }
        }

        /* Extra small phones */
        @media (max-width: 360px) {
            .container { padding: 12px 10px; }
            .logo-text { font-size: 20px; }
            .project-name { font-size: 16px; }
            .progress-value { font-size: 28px; }
            .stat-value { font-size: 18px; }
            .chart-container { height: 170px; }
            .btn { padding: 12px 16px; font-size: 13px; }
        }
    </style>
</head>
<body>
    <div class="container" id="content">
        <!-- Content loaded by JavaScript -->
    </div>
    <div class="toast" id="toast"></div>

    <script>
        // Translations
        const translations = {
            en: {
                subtitle: 'Project Progress Dashboard',
                overallProgress: 'Overall Progress',
                started: 'Started',
                expected: 'Expected',
                hours: 'hours',
                of: 'of',
                stagesComplete: 'Stages Complete',
                budgetUsed: 'Budget Used',
                timeSpent: 'Time Spent',
                stageProgress: 'Stage Progress',
                hoursBreakdown: 'Hours Breakdown',
                projectTimeline: 'Project Timeline',
                currentStage: 'Current Stage',
                whatsNext: "What's Next",
                estimated: 'Estimated',
                completed: 'Completed',
                inProgress: 'In Progress',
                upcoming: 'Upcoming',
                whatsDone: "What's Done",
                currentBlockers: 'Current Blockers',
                questions: 'Questions? Contact us at',
                lastUpdated: 'Last updated',
                invalidLink: 'Invalid Link',
                invalidLinkMsg: 'This progress link is invalid or has expired. Please contact your project manager for an updated link.',
                errorLoading: 'Unable to Load Project',
                errorLoadingMsg: 'There was an error loading the project data. Please contact your project manager.',
                spent: 'Spent',
                remaining: 'Remaining',
                actionRequired: 'Action Required From You',
                blockersAndIssues: 'Blockers & Issues',
                needsAttention: 'This item needs your attention',
                technicalProgress: 'Technical Progress',
                databaseSchema: 'Database Schema',
                apiEndpoints: 'API Endpoints',
                keyDeliverables: 'Key Deliverables',
                codePreview: 'Code Preview',
                yourFeedback: 'Your Feedback',
                feedbackSubtitle: 'Share your thoughts, questions, or concerns about the project progress',
                feedbackPlaceholder: 'Write your comments, questions, or suggestions here...',
                sendFeedback: 'Send Feedback',
                approveProgress: 'Approve Progress',
                requestChanges: 'Request Changes',
                feedbackSent: 'Thank you! Your feedback has been sent.',
                approvalSent: 'Progress approved! Thank you.',
                done: 'Done',
                pending: 'Pending',
                budgetHealth: 'Budget vs Spent',
                timeline: 'Time Progress',
                budget: 'Budget',
                onTrack: 'On Track',
                overBudget: 'Over Budget',
                daysRemaining: 'days remaining',
                daysElapsed: 'days elapsed',
                paidSoFar: 'Paid So Far',
                balanceDue: 'Balance Due',
                totalBudget: 'Total Budget'
            },
            he: {
                subtitle: '×œ×•×— ×ž×¢×§×‘ ×”×ª×§×“×ž×•×ª ×¤×¨×•×™×§×˜',
                overallProgress: '×”×ª×§×“×ž×•×ª ×›×•×œ×œ×ª',
                started: '×”×ª×—×œ×”',
                expected: '×¦×¤×™ ×¡×™×•×',
                hours: '×©×¢×•×ª',
                of: '×ž×ª×•×š',
                stagesComplete: '×©×œ×‘×™× ×”×•×©×œ×ž×•',
                budgetUsed: '×ª×§×¦×™×‘ ×‘×©×™×ž×•×©',
                timeSpent: '×–×ž×Ÿ ×©×”×•×©×§×¢',
                stageProgress: '×”×ª×§×“×ž×•×ª ×©×œ×‘×™×',
                hoursBreakdown: '×¤×™×œ×•×— ×©×¢×•×ª',
                projectTimeline: '×¦×™×¨ ×–×ž×Ÿ ×”×¤×¨×•×™×§×˜',
                currentStage: '×©×œ×‘ × ×•×›×—×™',
                whatsNext: '×ž×” ×”×œ××”',
                estimated: '×”×¢×¨×›×”',
                completed: '×”×•×©×œ×',
                inProgress: '×‘×‘×™×¦×•×¢',
                upcoming: '×‘×”×ž×ª× ×”',
                whatsDone: '×ž×” ×‘×•×¦×¢',
                currentBlockers: '×—×¡×ž×™× × ×•×›×—×™×™×',
                questions: '×©××œ×•×ª? ×¦×¨×• ×§×©×¨',
                lastUpdated: '×¢×•×“×›×Ÿ ×œ××—×¨×•× ×”',
                invalidLink: '×§×™×©×•×¨ ×œ× ×ª×§×™×Ÿ',
                invalidLinkMsg: '×§×™×©×•×¨ ×”×”×ª×§×“×ž×•×ª ××™× ×• ×ª×§×™×Ÿ ××• ×¤×’ ×ª×•×§×¤×•. ×× × ×¤× ×• ×œ×ž× ×”×œ ×”×¤×¨×•×™×§×˜ ×œ×§×‘×œ×ª ×§×™×©×•×¨ ×ž×¢×•×“×›×Ÿ.',
                errorLoading: '×©×’×™××” ×‘×˜×¢×™× ×”',
                errorLoadingMsg: '××™×¨×¢×” ×©×’×™××” ×‘×˜×¢×™× ×ª × ×ª×•× ×™ ×”×¤×¨×•×™×§×˜. ×× × ×¤× ×• ×œ×ž× ×”×œ ×”×¤×¨×•×™×§×˜.',
                spent: '×”×•×©×§×¢×•',
                remaining: '× ×•×ª×¨×•',
                actionRequired: '× ×“×¨×©×ª ×¤×¢×•×œ×” ×ž×¦×“×›×',
                blockersAndIssues: '×—×¡×ž×™× ×•×‘×¢×™×•×ª',
                needsAttention: '×¤×¨×™×˜ ×–×” ×“×•×¨×© ××ª ×ª×©×•×ž×ª ×œ×‘×›×',
                technicalProgress: '×”×ª×§×“×ž×•×ª ×˜×›× ×™×ª',
                databaseSchema: '×¡×›×ž×ª ×ž×¡×“ × ×ª×•× ×™×',
                apiEndpoints: '× ×§×•×“×•×ª ×§×¦×” API',
                keyDeliverables: '×ª×•×¦×¨×™× ×ž×¨×›×–×™×™×',
                codePreview: '×ª×¦×•×’×” ×ž×§×“×™×ž×” ×©×œ ×§×•×“',
                yourFeedback: '×”×ž×©×•×‘ ×©×œ×›×',
                feedbackSubtitle: '×©×ª×¤×• ××ª ×”×ž×—×©×‘×•×ª, ×”×©××œ×•×ª ××• ×”×—×©×©×•×ª ×©×œ×›× ×œ×’×‘×™ ×”×ª×§×“×ž×•×ª ×”×¤×¨×•×™×§×˜',
                feedbackPlaceholder: '×›×ª×‘×• ×›××Ÿ ××ª ×”×”×¢×¨×•×ª, ×”×©××œ×•×ª ××• ×”×”×¦×¢×•×ª ×©×œ×›×...',
                sendFeedback: '×©×œ×— ×ž×©×•×‘',
                approveProgress: '××©×¨ ×”×ª×§×“×ž×•×ª',
                requestChanges: '×‘×§×© ×©×™× ×•×™×™×',
                feedbackSent: '×ª×•×“×”! ×”×ž×©×•×‘ ×©×œ×›× × ×©×œ×—.',
                approvalSent: '×”×”×ª×§×“×ž×•×ª ××•×©×¨×”! ×ª×•×“×”.',
                done: '×”×•×©×œ×',
                pending: '×ž×ž×ª×™×Ÿ',
                budgetHealth: '×ª×§×¦×™×‘ ×ž×•×œ ×”×•×¦××•×ª',
                timeline: '×”×ª×§×“×ž×•×ª ×‘×–×ž×Ÿ',
                budget: '×ª×§×¦×™×‘',
                onTrack: '×‘×–×ž×Ÿ',
                overBudget: '×—×¨×™×’×”',
                daysRemaining: '×™×ž×™× × ×•×ª×¨×•',
                daysElapsed: '×™×ž×™× ×—×œ×¤×•',
                paidSoFar: '×©×•×œ× ×¢×“ ×›×”',
                balanceDue: '×™×ª×¨×” ×œ×ª×©×œ×•×',
                totalBudget: '×ª×§×¦×™×‘ ×›×•×œ×œ'
            }
        };

        let currentLang = 'en';
        let projectData = null;

        function t(key) {
            return translations[currentLang][key] || key;
        }

        function decodeProjectData(encoded) {
            try {
                return JSON.parse(decodeURIComponent(atob(encoded)));
            } catch (e) {
                return null;
            }
        }

        function formatDate(dateStr) {
            if (!dateStr) return '-';
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            return new Date(dateStr).toLocaleDateString(currentLang === 'he' ? 'he-IL' : 'en-US', options);
        }

        function setLanguage(lang) {
            currentLang = lang;
            document.body.classList.toggle('rtl', lang === 'he');
            renderProgress();
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        function sendFeedback(type) {
            const textarea = document.getElementById('feedbackText');
            const message = textarea ? textarea.value : '';
            const project = projectData;
            const urlParams = new URLSearchParams(window.location.search);
            const projectId = urlParams.get('p') || 'unknown';

            if (type === 'feedback' && !message.trim()) {
                alert(currentLang === 'he' ? '×× × ×›×ª×‘×• ×ž×©×•×‘ ×œ×¤× ×™ ×”×©×œ×™×—×”' : 'Please write your feedback before sending');
                return;
            }

            const subject = type === 'approval'
                ? `[${projectId}] Progress Approved: ${project.n}`
                : `[${projectId}] Client Feedback: ${project.n}`;

            // Format message as potential task items
            const formattedMessage = type === 'approval'
                ? `Client has approved the current progress (${project.p}%) for project: ${project.n}`
                : `PROJECT: ${project.n}\nCLIENT: ${project.c}\nPROJECT_ID: ${projectId}\nPROGRESS: ${project.p}%\n\n--- CLIENT FEEDBACK ---\n${message}\n\n--- SUGGESTED TASKS ---\nPlease review and create tasks from the above feedback.`;

            // Using Formspree for form submission
            fetch('https://formspree.io/f/xnnqbqkk', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    project_id: projectId,
                    project_name: project.n,
                    client: project.c,
                    type: type,
                    progress: project.p + '%',
                    feedback: message || 'Progress Approved',
                    timestamp: new Date().toISOString(),
                    _subject: subject
                })
            }).then(response => {
                if (response.ok) {
                    showToast(type === 'approval' ? t('approvalSent') : t('feedbackSent'));
                    if (textarea) textarea.value = '';
                }
            }).catch(() => {
                // Fallback to mailto
                const mailtoLink = `mailto:avi@drishticonsulting.com?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(formattedMessage)}`;
                window.open(mailtoLink, '_blank');
                showToast(type === 'approval' ? t('approvalSent') : t('feedbackSent'));
                if (textarea) textarea.value = '';
            });
        }

        function renderCharts(project) {
            // VIBRANT Stage Progress Chart - Rainbow colors
            const completedStages = project.s.filter(s => s.st === 'completed').length;
            const inProgressStages = project.s.filter(s => s.st === 'in_progress').length;
            const upcomingStages = project.s.filter(s => s.st === 'not_started').length;

            const stageCtx = document.getElementById('stageChart');
            if (stageCtx) {
                new Chart(stageCtx, {
                    type: 'doughnut',
                    data: {
                        labels: [t('completed'), t('inProgress'), t('upcoming')],
                        datasets: [{
                            data: [completedStages, inProgressStages, upcomingStages],
                            backgroundColor: ['#22c55e', '#f59e0b', '#ef4444'],  // Green, Orange, Red
                            hoverBackgroundColor: ['#16a34a', '#d97706', '#dc2626'],
                            borderWidth: 3,
                            borderColor: '#0f172a'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    color: '#e2e8f0',
                                    padding: 12,
                                    font: { size: 11, weight: '600' },
                                    usePointStyle: true,
                                    pointStyle: 'circle'
                                }
                            }
                        },
                        cutout: '60%'
                    }
                });
            }

            // COLORFUL Budget Health - Multi-color gradient gauge
            const budgetCtx = document.getElementById('budgetChart');
            if (budgetCtx) {
                const budgetUsedPercent = project.h > 0 ? Math.round((project.hs / project.h) * 100) : 0;
                const progressPercent = project.p;

                // Compare budget spent vs progress made
                const efficiency = progressPercent > 0 ? (budgetUsedPercent / progressPercent) : 1;
                let statusColor, statusText;
                if (efficiency <= 0.9) {
                    statusColor = '#22c55e'; statusText = 'Excellent';
                } else if (efficiency <= 1.1) {
                    statusColor = '#3b82f6'; statusText = t('onTrack');
                } else if (efficiency <= 1.3) {
                    statusColor = '#f59e0b'; statusText = 'Watch';
                } else {
                    statusColor = '#ef4444'; statusText = t('overBudget');
                }

                new Chart(budgetCtx, {
                    type: 'doughnut',
                    data: {
                        labels: [t('spent'), t('remaining')],
                        datasets: [{
                            data: [budgetUsedPercent, Math.max(0, 100 - budgetUsedPercent)],
                            backgroundColor: [statusColor, 'rgba(255,255,255,0.1)'],
                            hoverBackgroundColor: [statusColor, 'rgba(255,255,255,0.15)'],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        rotation: -90,
                        circumference: 180,
                        plugins: { legend: { display: false } },
                        cutout: '70%'
                    },
                    plugins: [{
                        id: 'centerText',
                        afterDraw: (chart) => {
                            const ctx = chart.ctx;
                            const centerX = chart.width / 2;
                            const centerY = chart.height - 25;
                            ctx.save();
                            ctx.font = 'bold 32px Open Sans, Heebo, sans-serif';
                            ctx.fillStyle = statusColor;
                            ctx.textAlign = 'center';
                            ctx.fillText(`${budgetUsedPercent}%`, centerX, centerY);
                            ctx.font = 'bold 13px Open Sans, Heebo, sans-serif';
                            ctx.fillStyle = statusColor;
                            ctx.fillText(statusText, centerX, centerY + 22);
                            ctx.restore();
                        }
                    }]
                });
            }

            // RAINBOW Hours Bar Chart - Multiple vibrant colors per stage
            const hoursCtx = document.getElementById('hoursChart');
            if (hoursCtx) {
                const stageNames = project.s.map(s => s.n.substring(0, 15) + (s.n.length > 15 ? '...' : ''));
                const stageHours = project.s.map(s => s.ah || 0);
                const rainbowColors = [
                    '#ef4444', '#f97316', '#f59e0b', '#84cc16', '#22c55e', '#14b8a6',
                    '#06b6d4', '#3b82f6', '#6366f1', '#8b5cf6', '#a855f7', '#ec4899'
                ];

                new Chart(hoursCtx, {
                    type: 'bar',
                    data: {
                        labels: stageNames,
                        datasets: [{
                            label: t('hours'),
                            data: stageHours,
                            backgroundColor: rainbowColors.slice(0, project.s.length),
                            borderRadius: 6,
                            borderSkipped: false
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        indexAxis: 'y',
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                backgroundColor: 'rgba(15, 23, 42, 0.95)',
                                titleColor: '#f1f5f9',
                                bodyColor: '#cbd5e1',
                                borderColor: 'rgba(255,255,255,0.1)',
                                borderWidth: 1,
                                padding: 12,
                                cornerRadius: 8
                            }
                        },
                        scales: {
                            x: {
                                grid: { color: 'rgba(255,255,255,0.05)' },
                                ticks: { color: '#94a3b8', font: { size: 10 } }
                            },
                            y: {
                                grid: { display: false },
                                ticks: { color: '#e2e8f0', font: { size: 10, weight: '500' } }
                            }
                        }
                    }
                });
            }

            // COLORFUL Timeline Polar Area Chart
            const timelineCtx = document.getElementById('timelineChart');
            if (timelineCtx) {
                const startDate = new Date(project.sd);
                const endDate = new Date(project.ed);
                const today = new Date();
                const totalDays = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24));
                const daysElapsed = Math.max(0, Math.ceil((today - startDate) / (1000 * 60 * 60 * 24)));
                const daysRemaining = Math.max(0, totalDays - daysElapsed);
                const timePercent = totalDays > 0 ? Math.min(100, Math.round((daysElapsed / totalDays) * 100)) : 0;
                const progressPercent = project.p;

                // Are we ahead or behind schedule?
                const scheduleStatus = progressPercent >= timePercent;

                new Chart(timelineCtx, {
                    type: 'polarArea',
                    data: {
                        labels: [t('daysElapsed'), t('daysRemaining'), t('completed')],
                        datasets: [{
                            data: [daysElapsed, daysRemaining, progressPercent],
                            backgroundColor: [
                                'rgba(251, 146, 60, 0.8)',   // Orange - elapsed
                                'rgba(34, 197, 94, 0.8)',   // Green - remaining
                                'rgba(99, 102, 241, 0.8)'   // Purple - progress
                            ],
                            borderColor: [
                                '#fb923c',
                                '#22c55e',
                                '#6366f1'
                            ],
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    color: '#e2e8f0',
                                    padding: 10,
                                    font: { size: 10, weight: '500' },
                                    usePointStyle: true
                                }
                            },
                            title: {
                                display: true,
                                text: scheduleStatus ? 'On Schedule' : 'Behind Schedule',
                                color: scheduleStatus ? '#22c55e' : '#f59e0b',
                                font: { size: 13, weight: '700' },
                                padding: { bottom: 8 }
                            }
                        },
                        scales: {
                            r: {
                                grid: { color: 'rgba(255,255,255,0.08)' },
                                ticks: { display: false }
                            }
                        }
                    }
                });
            }
        }

        function renderBlockers(project) {
            const blockers = project.s.filter(s => s.bl && s.bl.trim()).map(s => ({
                stage: s.n,
                blocker: s.bl,
                action: s.ar // action required from client
            }));

            if (blockers.length === 0) return '';

            return `
                <div class="blockers-section">
                    <div class="blockers-header">
                        <div class="blockers-icon">âš </div>
                        <div class="blockers-title">${t('blockersAndIssues')}</div>
                    </div>
                    ${blockers.map(b => `
                        <div class="blocker-item">
                            <div class="blocker-text"><strong>${b.stage}:</strong> ${b.blocker}</div>
                            ${b.action ? `
                                <div class="blocker-action">
                                    <div class="action-label">${t('actionRequired')}</div>
                                    <div class="action-text">${b.action}</div>
                                </div>
                            ` : ''}
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function renderTechnicalSection(project) {
            if (!project.tech) return '';

            const tech = project.tech;
            return `
                <div class="tech-section">
                    <div class="tech-header">
                        <div class="tech-icon">âš¡</div>
                        <div class="tech-title">${t('technicalProgress')}</div>
                    </div>
                    <div class="tech-grid">
                        ${tech.db ? `
                            <div class="tech-card">
                                <div class="tech-card-title">${t('databaseSchema')}</div>
                                <div class="code-block">${tech.db}</div>
                            </div>
                        ` : ''}
                        ${tech.api ? `
                            <div class="tech-card">
                                <div class="tech-card-title">${t('apiEndpoints')}</div>
                                <div class="code-block">${tech.api}</div>
                            </div>
                        ` : ''}
                    </div>
                    ${tech.deliverables && tech.deliverables.length > 0 ? `
                        <div class="tech-card" style="margin-top: 16px;">
                            <div class="tech-card-title">${t('keyDeliverables')}</div>
                            <ul class="deliverables-list">
                                ${tech.deliverables.map(d => `
                                    <li>
                                        <span class="deliverable-status ${d.done ? 'deliverable-done' : 'deliverable-pending'}">${d.done ? 'âœ“' : 'â—‹'}</span>
                                        <span>${d.name}</span>
                                    </li>
                                `).join('')}
                            </ul>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function renderFeedbackSection() {
            return `
                <div class="feedback-section">
                    <div class="feedback-header">
                        <div class="feedback-icon">ðŸ’¬</div>
                        <div class="feedback-title">${t('yourFeedback')}</div>
                    </div>
                    <div class="feedback-subtitle">${t('feedbackSubtitle')}</div>
                    <div class="feedback-form">
                        <div class="form-group">
                            <textarea id="feedbackText" class="form-textarea" placeholder="${t('feedbackPlaceholder')}"></textarea>
                        </div>
                        <div class="form-actions">
                            <button class="btn btn-primary" onclick="sendFeedback('feedback')">
                                âœ‰ ${t('sendFeedback')}
                            </button>
                            <button class="btn btn-success" onclick="sendFeedback('approval')">
                                âœ“ ${t('approveProgress')}
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        async function renderProgress() {
            const urlParams = new URLSearchParams(window.location.search);
            const projectId = urlParams.get('p'); // Short project ID
            const data = urlParams.get('d'); // Full encoded data (legacy)

            let project = null;

            // Try short project ID first (fetch from JSON file)
            if (projectId) {
                try {
                    const response = await fetch('projects-data.json');
                    const projectsData = await response.json();
                    project = projectsData[projectId];
                } catch (e) {
                    console.error('Failed to load project:', e);
                }
            }
            // Fall back to encoded data in URL
            else if (data) {
                project = decodeProjectData(data);
            }

            if (!project) {
                document.getElementById('content').innerHTML = `
                    <div class="error-message">
                        <div class="logo-container">
                            <svg class="logo-icon" viewBox="0 0 100 100"><circle cx="50" cy="50" r="45" fill="none" stroke="#4a5568" stroke-width="2"/><circle cx="50" cy="50" r="32" fill="none" stroke="#4a5568" stroke-width="2"/><circle cx="50" cy="50" r="20" fill="none" stroke="#4a5568" stroke-width="2"/><circle cx="50" cy="50" r="10" fill="none" stroke="#6366f1" stroke-width="2.5"/><circle cx="50" cy="50" r="4" fill="#6366f1"/></svg>
                            <span class="logo-text">Drishti</span>
                        </div>
                        <h2>${t('invalidLink')}</h2>
                        <p>${t('invalidLinkMsg')}</p>
                    </div>
                `;
                return;
            }

            projectData = project;

            const currentStage = project.s.find(s => s.st === 'in_progress') || project.s.find(s => s.st === 'not_started');
            const nextStage = project.s.find(s => s.st === 'not_started');
            const completedCount = project.s.filter(s => s.st === 'completed').length;
            const budgetUsed = project.h > 0 ? Math.round((project.hs / project.h) * project.b) : 0;

            document.getElementById('content').innerHTML = `
                <div class="lang-toggle">
                    <button class="lang-btn ${currentLang === 'en' ? 'active' : ''}" onclick="setLanguage('en')">English</button>
                    <button class="lang-btn ${currentLang === 'he' ? 'active' : ''}" onclick="setLanguage('he')">×¢×‘×¨×™×ª</button>
                </div>

                <div class="header">
                    <div class="logo-container">
                        <svg class="logo-icon" viewBox="0 0 100 100">
                            <circle cx="50" cy="50" r="45" fill="none" stroke="#4a5568" stroke-width="2"/>
                            <circle cx="50" cy="50" r="32" fill="none" stroke="#4a5568" stroke-width="2"/>
                            <circle cx="50" cy="50" r="20" fill="none" stroke="#4a5568" stroke-width="2"/>
                            <circle cx="50" cy="50" r="10" fill="none" stroke="#6366f1" stroke-width="2.5"/>
                            <circle cx="50" cy="50" r="4" fill="#6366f1"/>
                        </svg>
                        <span class="logo-text">Drishti</span>
                    </div>
                    <div class="subtitle">${t('subtitle')}</div>
                    <h1 class="project-name">${project.n}</h1>
                    <div class="client-name">${project.c}</div>
                </div>

                <div class="progress-card">
                    <div class="progress-label">${t('overallProgress')}</div>
                    <div class="progress-bar-container">
                        <div class="progress-bar" style="width: ${project.p}%"></div>
                    </div>
                    <div class="progress-value">${project.p}%</div>
                    <div class="dates">
                        ${t('started')}: ${formatDate(project.sd)} &nbsp;|&nbsp; ${t('expected')}: ${formatDate(project.ed)}
                    </div>
                </div>

                <div class="stats-grid" style="grid-template-columns: repeat(4, 1fr);">
                    <div class="stat-card">
                        <div class="stat-value">${project.hs} ${t('hours')}</div>
                        <div class="stat-label">${t('of')} ${project.h} ${t('hours')}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">â‚ª${project.b.toLocaleString()}</div>
                        <div class="stat-label">${t('totalBudget')}</div>
                    </div>
                    <div class="stat-card" style="background: rgba(34, 197, 94, 0.1); border-color: rgba(34, 197, 94, 0.3);">
                        <div class="stat-value" style="color: #22c55e;">â‚ª${(project.paid || 0).toLocaleString()}</div>
                        <div class="stat-label">${t('paidSoFar')}</div>
                    </div>
                    <div class="stat-card" style="background: rgba(249, 115, 22, 0.1); border-color: rgba(249, 115, 22, 0.3);">
                        <div class="stat-value" style="color: #f97316;">â‚ª${(project.b - (project.paid || 0)).toLocaleString()}</div>
                        <div class="stat-label">${t('balanceDue')}</div>
                    </div>
                </div>

                <div class="charts-grid" style="grid-template-columns: repeat(2, 1fr);">
                    <div class="chart-card" style="background: linear-gradient(135deg, rgba(34, 197, 94, 0.15) 0%, rgba(245, 158, 11, 0.15) 50%, rgba(239, 68, 68, 0.15) 100%); border: 1px solid rgba(34, 197, 94, 0.3);">
                        <div class="chart-title" style="color: #4ade80; font-weight: 700;">${t('stageProgress')}</div>
                        <div class="chart-container">
                            <canvas id="stageChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-card" style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.15) 0%, rgba(34, 197, 94, 0.15) 50%, rgba(245, 158, 11, 0.1) 100%); border: 1px solid rgba(59, 130, 246, 0.3);">
                        <div class="chart-title" style="color: #60a5fa; font-weight: 700;">${t('budgetHealth')}</div>
                        <div class="chart-container">
                            <canvas id="budgetChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-card" style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.12) 0%, rgba(249, 115, 22, 0.12) 20%, rgba(245, 158, 11, 0.12) 40%, rgba(132, 204, 22, 0.12) 60%, rgba(6, 182, 212, 0.12) 80%, rgba(168, 85, 247, 0.12) 100%); border: 1px solid rgba(249, 115, 22, 0.3);">
                        <div class="chart-title" style="background: linear-gradient(90deg, #ef4444, #f97316, #eab308, #22c55e, #06b6d4, #8b5cf6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; font-weight: 700;">${t('hoursBreakdown')}</div>
                        <div class="chart-container">
                            <canvas id="hoursChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-card" style="background: linear-gradient(135deg, rgba(251, 146, 60, 0.2) 0%, rgba(34, 197, 94, 0.15) 50%, rgba(99, 102, 241, 0.15) 100%); border: 1px solid rgba(251, 146, 60, 0.3);">
                        <div class="chart-title" style="color: #fb923c; font-weight: 700;">${t('timeline')}</div>
                        <div class="chart-container">
                            <canvas id="timelineChart"></canvas>
                        </div>
                    </div>
                </div>

                ${renderBlockers(project)}

                ${currentStage ? `
                <div class="current-stage-card">
                    <div class="current-stage-label">${t('currentStage')}</div>
                    <div class="current-stage-name">${currentStage.n}</div>
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <div style="flex: 1; background: rgba(255,255,255,0.1); border-radius: 6px; height: 8px; overflow: hidden;">
                            <div style="background: var(--gradient); height: 100%; width: ${currentStage.p}%;"></div>
                        </div>
                        <span>${currentStage.p}%</span>
                    </div>
                    ${currentStage.nt ? `<div class="stage-notes"><strong>${t('whatsDone')}:</strong><br>${currentStage.nt}</div>` : ''}
                </div>
                ` : ''}

                ${renderTechnicalSection(project)}

                <h2 class="section-title">${t('projectTimeline')}</h2>
                <div class="timeline">
                    ${project.s.map((stage, idx) => `
                        <div class="stage ${stage.st}">
                            <div class="stage-icon">${stage.st === 'completed' ? 'âœ“' : stage.st === 'in_progress' ? 'â–º' : idx + 1}</div>
                            <div class="stage-header">
                                <div class="stage-name">${stage.n}</div>
                                <div class="stage-progress">${stage.st === 'completed' ? t('completed') : stage.st === 'in_progress' ? `${stage.p}% ${t('inProgress')}` : t('upcoming')}</div>
                            </div>
                            <div class="stage-hours">${stage.ah}/${stage.eh} ${t('hours')}</div>
                            ${stage.st === 'completed' && stage.nt ? `<div class="stage-notes">${stage.nt}</div>` : ''}
                        </div>
                    `).join('')}
                </div>

                ${nextStage && nextStage !== currentStage ? `
                <h2 class="section-title">${t('whatsNext')}</h2>
                <div class="stat-card" style="text-align: ${currentLang === 'he' ? 'right' : 'left'};">
                    <div class="stage-name">${nextStage.n}</div>
                    <div class="stage-hours" style="margin-top: 8px;">${t('estimated')}: ${nextStage.eh} ${t('hours')}</div>
                </div>
                ` : ''}

                ${renderFeedbackSection()}

                <div class="footer">
                    <p>${t('questions')} <a href="mailto:avi@drishticonsulting.com">avi@drishticonsulting.com</a></p>
                    <p style="margin-top: 8px; font-size: 12px;">${t('lastUpdated')}: ${project.u ? formatDate(project.u) : '-'}</p>
                    <p style="margin-top: 20px;">&copy; ${new Date().getFullYear()} Drishti Consulting</p>
                </div>
            `;

            // Render charts after DOM is ready
            setTimeout(() => renderCharts(project), 100);
        }

        renderProgress();
    </script>
</body>
</html>
